-- 9.	Закройте продукты (установите дату закрытия равную текущей) типа КРЕДИТ, у которых 
-- произошло полное погашение, но при этом не было повторной выдачи.update PRODUCTS set CLOSE_DATE = CAST(CURRENT_TIMESTAMP AS DATE)where PRODUCTS.ID = 	(select table_B.Product_ID	from		(select distinct table_A.*		from			(select prod.ID as 'Product_ID',				(select SUM (rec.SUM)				from RECORDS rec				join ACCOUNTS acc on acc.ID = rec.ACC_REF				join CLIENTS cl on cl.ID = acc.CLIENT_REF				where rec.DT = 1					and cli.ID = cl.ID) as SUM_1,				(select SUM (rec.SUM)				from RECORDS rec				join ACCOUNTS acc on acc.ID = rec.ACC_REF				join CLIENTS cl on cl.ID = acc.CLIENT_REF				where rec.DT = 0					and cli.ID = cl.ID) as SUM_2			from PRODUCTS prod			join CLIENTS cli on cli.ID = prod.CLIENT_REF) table_A		join PRODUCTS prod on prod.ID = table_A.Product_ID		join CLIENTS cl on cl.ID = prod.CLIENT_REF		join ACCOUNTS acc on acc.PRODUCT_REF = prod.ID		join RECORDS rec on rec.ACC_REF = acc.ID		where prod.PRODUCT_TYPE_ID = 1			and prod.CLOSE_DATE is null			and table_A.SUM_1 = table_A.SUM_2) table_B)